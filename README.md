# Stock Trading Environment Agent Instructions

This document provides instructions for agents working with the `stock_trading_env` project.

## Project Structure

-   `data/`: Stores downloaded CSV files of stock historical data.
-   `pull_data.py`: Script to download historical stock data using Yahoo Finance.
-   `trading_env.py`: Implements the `TradingEnv` Gymnasium environment for stock trading.
-   `requirements.txt`: Lists Python dependencies.
-   `main.py` (to be created): Example script to demonstrate usage of the components.

## Setup and Installation

1.  **Create a virtual environment (recommended):**
    ```bash
    python -m venv venv
    source venv/bin/activate  # On Windows: venv\Scripts\activate
    ```

2.  **Install dependencies:**
    Navigate to the `stock_trading_env` directory (where `requirements.txt` is located) and run:
    ```bash
    pip install -r requirements.txt
    ```
    *If running scripts via an agent tool that has its CWD at `/app/stock_trading_env/stock_trading_env/` (a nested directory), ensure that `pip install -r ../requirements.txt` is used if `requirements.txt` is in `/app/stock_trading_env/`.*

## Running Scripts

All commands below assume you are in the `stock_trading_env` directory, unless otherwise specified. If your agent's execution environment has a different working directory, adjust paths accordingly. For example, if the agent's CWD is `/app/` (the parent of `stock_trading_env/`), then commands like `python pull_data.py ...` would become `python stock_trading_env/pull_data.py ...`.

The development environment for this agent seems to have a CWD of `/app/stock_trading_env/stock_trading_env/`.
- `pull_data.py` is at `../pull_data.py`
- `trading_env.py` is at `../trading_env.py`
- `data/` directory is at `../data/`
- `requirements.txt` is at `../requirements.txt`

### 1. Download Stock Data

Use `pull_data.py` to download data for specific stock tickers.

**Syntax:**
```bash
# If CWD is stock_trading_env/
python pull_data.py <TICKER1> [TICKER2 ...] [--start YYYY-MM-DD] [--end YYYY-MM-DD] [--data_dir DIR_NAME]
```

**Example (from `stock_trading_env/`):**
```bash
python pull_data.py AAPL MSFT --start 2020-01-01 --end 2023-12-31 --data_dir data
```
This will save `AAPL.csv` and `MSFT.csv` into the `stock_trading_env/data/` directory.

**Agent Specific Example (if CWD is `/app/stock_trading_env/stock_trading_env/`):**
```bash
python ../pull_data.py AAPL MSFT --start 2020-01-01 --end 2023-12-31 --data_dir data
```
(Note: `pull_data.py` itself will correctly place data into `../data/` relative to the CWD, because its `--data_dir` argument is relative to the script's location, which is `../`.)

### 2. Using the Trading Environment

The `trading_env.py` script contains the `TradingEnv` class. It also has an example `if __name__ == "__main__":` block that demonstrates how to initialize and run the environment.

**To run the example within `trading_env.py`:**

Ensure you have the necessary data (e.g., `AAPL.csv`) in the `data/` directory. The example will attempt to download it if missing.

**Example (from `stock_trading_env/`):**
```bash
python trading_env.py
```

**Agent Specific Example (if CWD is `/app/stock_trading_env/stock_trading_env/`):**
```bash
python ../trading_env.py
```
This will run the environment with 'AAPL' data and render using `matplotlib` if a display is available, otherwise it will fallback gracefully or just print to console depending on the exact setup.

### 3. Running the Main Example (main.py)

A `main.py` script will be provided to demonstrate a typical workflow:
1.  Download data for a ticker.
2.  Initialize the `TradingEnv`.
3.  Run a loop with some actions (e.g., random or simple strategy).
4.  Render the environment.

**Example (from `stock_trading_env/`, once `main.py` is created):**
```bash
python main.py
```

**Agent Specific Example (if CWD is `/app/stock_trading_env/stock_trading_env/`, once `main.py` is created in `../`):**
```bash
python ../main.py
```

## Notes for Agent

-   **File Paths:** Be mindful of your current working directory when executing scripts or accessing files. The scripts (`pull_data.py`, `trading_env.py`) are designed to locate the `data` directory relative to their own file location.
-   **Rendering:** The `human` render mode for `TradingEnv` uses `matplotlib`. Ensure your execution environment supports GUI display if you need to see the plots. Otherwise, use `render_mode='ansi'` or expect no visual output for plots.
-   **Data Format:** Stock data CSVs are expected to be in the format generated by `yfinance`, with 'Date' as the index and columns for 'Open', 'High', 'Low', 'Close', 'Volume'. The environment handles the multi-index column headers that `yfinance` might produce.